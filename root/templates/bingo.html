<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Lifest Prison Break</title>
    <style>
        table, td {
            border: 1px solid black;
            border-collapse: collapse;
            font-size: 20px;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript">
        var N = 16;
        var flag = 0;
        var input_num = [];

        function key_insert(){
            var str = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16];
            var a1 = document.getElementById("a1").value;
            var a2 = document.getElementById("a2").value;
            var a3 = document.getElementById("a3").value;
            var a4 = document.getElementById("a4").value;
            var b1 = document.getElementById("b1").value;
            var b2 = document.getElementById("b2").value;
            var b3 = document.getElementById("b3").value;
            var b4 = document.getElementById("b4").value;
            var c1 = document.getElementById("c1").value;
            var c2 = document.getElementById("c2").value;
            var c3 = document.getElementById("c3").value;
            var c4 = document.getElementById("c4").value;
            var d1 = document.getElementById("d1").value;
            var d2 = document.getElementById("d2").value;
            var d3 = document.getElementById("d3").value;
            var d4 = document.getElementById("d4").value;
            var inserted = [a1, a2, a3, a4, b1, b2, b3, b4, c1, c2, c3, c4, d1, d2, d3, d4];

            var diff = arr_diff(str, inserted);
            if (diff == "") {
                window.flag = 1;
                window.input_num = inserted;
            } else {
                window.flag = 0;
            }
            document.getElementById("leftnumbers").value = diff;
        };

        function arr_diff(a1, a2) {
            var a = [], diff = [];
            for (var i = 0; i < a1.length; i++) {
                a[a1[i]] = true;
            }
            for (var i = 0; i < a2.length; i++) {
                if (a[a2[i]]) {
                    delete a[a2[i]];
                } else {
                    a[a2[i]] = true;
                }
            }
            for (var k in a) {
                diff.push(k);
            }
            return diff;
        };

        function submit_bingo() {
              if (flag == 1) {
                var encoded = "";
                var str_enc = "abcdefghijklmnopqrstuvwxyz";

                for (var i = 0; i < N; i++) {
                    encoded = encoded + str_enc[window.input_num[i]];
                }

                var url = "/play?code=" + encoded;
                window.location = url;
              } else {
                alert("뭔가 이상한데?")
              }
        };
        function shuffle(string) {
            var parts = string.split('');
            for (var i = parts.length; i > 0;) {
                var random = parseInt(Math.random() * i);
                var temp = parts[--i];
                parts[i] = parts[random];
                parts[random] = temp;
            }
            return parts.join('');
        }

        function submit_random() {
            var str_enc = "bcdefghijklmnopq";
            var shuffled = shuffle(str_enc);
            var url = "/play?code=" + shuffled;
            window.location = url;
        };
    </script>


</head>
<body>
<div class="container" style="padding: 20px; width: 80%; border: 0px solid black; margin: auto;">
    <div class="headtitle" style="padding: 2px; width: 100%; border: 0px solid black; margin: auto; text-align: center">
        <h2>만들자 빙고</h2>
    </div>
    <div class="inputfield" style="padding: 2px; width: 100%; border: 1px solid black; margin: auto; text-align: center">
        <table cellpadding="10" style="width: 100%; margin: auto; text-align: center;">
            <tr>
                <td><input type="text" pattern="\d*" id="a1" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
                <td><input type="text" pattern="\d*" id="b1" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
                <td><input type="text" pattern="\d*" id="c1" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
                <td><input type="text" pattern="\d*" id="d1" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
            </tr>
            <tr>
                <td><input type="text" pattern="\d*" id="a2" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
                <td><input type="text" pattern="\d*" id="b2" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
                <td><input type="text" pattern="\d*" id="c2" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
                <td><input type="text" pattern="\d*" id="d2" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
            </tr>
            <tr>
                <td><input type="text" pattern="\d*" id="a3" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
                <td><input type="text" pattern="\d*" id="b3" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
                <td><input type="text" pattern="\d*" id="c3" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
                <td><input type="text" pattern="\d*" id="d3" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
            </tr>
            <tr>
                <td><input type="text" pattern="\d*" id="a4" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
                <td><input type="text" pattern="\d*" id="b4" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
                <td><input type="text" pattern="\d*" id="c4" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
                <td><input type="text" pattern="\d*" id="d4" min="1" max="16" maxlength="2" size="3" onKeyUp="key_insert();"></td>
            </tr>
        </table>
    </div>
    <div class="checkfield" style="padding: 10px; width: 100%; border: 0px solid black; margin: auto; text-align: center">
        남은 숫자 : <input type="text" id="leftnumbers" size="30" disabled />
    </div>
    <div class="noticefield" style="padding: 10px; width: 100%; border: 0px solid black; margin: auto; text-align: center">
        * 같은 숫자가 있으면 제출이 안되요
    </div>
    <div class="submitfield" style="padding: 10px; width: 100%; border: 0px solid black; margin: auto; text-align: center">
        <input type="button" id="random" onclick="submit_random();" value="랜덤제출"> <input type="button" id="submit" onclick="submit_bingo();" value="제출하기">
    </div>
</div>
</body>
</html>